---
date: 2019-07-02
---

# 什么是区块链？

说到区块链就不得不提到比特币。

2008 年爆发全球经济危机，当年 11 月 1 日，一个化名为中本聪的人发表了比特币白皮书，《比特币：一个点对点的电子现金系统》。次年 1 月，比特币创世区块诞生。

比特币是一种数字货币，在白皮书中，比特币被设想为一种去中心化的电子记账系统。比特币的重点就是去中心化和记账。

对于传统货币来说，记账行为是由银行来完成的。比如如果我们要向别人转账时，首先要检查我们的账户余额是否足够，然后还要记录转账结束账户还剩多少余额，这个过程就是记账。生活中无论我们使用银行卡、信用卡进行交易，或者使用支付宝、微信转账，记账始终是由银行来完成的。我们信任银行，是因为信任银行背后的国家的信用。

而在白皮书中，比特币被设计为一种去中心化的货币，记账都交给我们自己完成，并且每个人都可以查看账本，所有账本都是透明的，这就叫去中心化电子记账系统。

举例来说，有甲、乙、丙、丁四个人，现在甲要支付给乙 1 个比特币，那么甲要做的就是向乙支付 1 一个比特币，并且将这条信息广播出去。

```
甲 --- 1 BTC ---> 乙
甲 --- 广播 ---> 丙
甲 --- 广播 ---> 丁
```

然后乙支付给丙 2 个比特币，同时也将信息广播出去。

```
乙 --- 2 BTC ---> 丙
乙 --- 广播 ---> 甲
乙 --- 广播 ---> 丁
```

再接着丙支付给丁 5 个比特币，同时也进行广播。

```
丙 --- 5 BTC ---> 丁
丙 --- 广播 ---> 甲
丙 --- 广播 ---> 乙
```

现在甲乙丙丁的账本是下面这样的。

```
甲 --- 1 BTC ---> 乙
乙 --- 2 BTC ---> 丙
丙 --- 5 BTC ---> 丁
```

这个账本会被打包成一个块，这个块我们就称之为区块（Block）。一个区块的大小是 1MB，里面大概可以存 4000 条交易记录。这个区块打包完成之后，我们就把它链接到以前的交易记录上，过一段时间之后后续的区块也会被连接到这个区块上，这样就形成了一条链，就是所谓的区块链（Block Chain）。

不过要实现这样一个去中心化的电子记账系统，还要解决很多问题，比如这些问题：

- 为什么要帮你打包？为什么要消耗系统资源给与己无关的交易记录打包成区块？
- 该相信谁？每个人都可以有自己的账本，那么以谁的账本为准呢？
- 如何认证和防伪？假如有人想要伪装成另一个人进行支付，需要如何证伪呢？
- 如何防止双重支付？比如一个人只有 10 个比特币，但是他同时向两个人支付 10 比特币，结果会怎么样？
- 如何防止篡改？区块链上的交易记录如何防止别人篡改？

其他还有很多问题，但是现在我们就对这些问题进行说明。

## 为什么我要帮你记账/打包区块？

记账是有奖励的，奖励分为两方面。

- 每一笔记账有手续费；
- 每一个区块打包有奖励。

每一笔交易都有手续费，这个手续费由交易的发起者支付，比如甲要支付给乙 10 个比特币，那么甲需要多出一点手续费。

每个成功打包区块的人还会收到一份奖励，根据中本聪提出的比特币白皮书提出的方案，每十分钟打一个包，并且最开始每一个包将会奖励打包的人 50 个比特币。四年减半，也就是说头四年每成功打一个包奖励 50 个比特币，四年之后的四年内每成功打一个包奖励 25 比特币，再往后四年每成功一个奖励 12.5 个比特币，以此类推。这样比特币的发行量其实是固定的，到最后将发行一共 2100 万个比特币。

所以其实比特币主要通过打包奖励的方式扩散，因为打包有这样的奖励，所以人们都抢着去打包，那么这样就会出现每个人账本不同的情况。

## 该相信谁？

每个人都抢着去打包，每个人的账本也可能不同，但是每个区块最终只有一个人能打包成功，那么我们到底该相信谁？

为了解决这个问题，中本聪提出了一个方法——工作量证明，简单的说，就是让每个参与打包的用户都去做一道很复杂的数学题，第一个完成这个数学题的人将有权利进行打包，并且获得手续费和打包奖励。

这道数学题非常复杂，复杂到根本无法通过计算的方式获得答案，只能通过计算机一个一个数字去尝试，如果正确就可以获得奖励，而这个过程就是所谓的“挖矿”。

接下来我们说说这个数学题具体是什么。这就要提到 Hash 函数，或者说数字摘要，这是一种通过特定的运算将一份数据转化为一份摘要的形式，并且有从数据转化为摘要简单，但是从摘要中还原数据则十分困难的特性。

比特币使用到其中著名的 SHA256 算法，这是一个由美国国家安全局发明的一个算法。如果我们将一个字符串输入到 SHA256 函数，将得到一个 256 位的二进制数，它的结果没有规律，并且对输入数据就算仅做一点点修改也可能会导致结果大范围变动。而且 SHA256 计算摘要的过程非常快，但是如果想通过摘要还原数据则非常困难，几乎是不可能的，只能通过修改输入数据一个个去试验，碰撞出结果。

了解了 SHA256 算法，我们再来说挖矿的原理。首先我们知道区块链上面的每一个区块都储存了一份账本，但是除了账本之外还有一个头部信息。现在有很多人都在参与打包，每一个人收集周围的交易记录形成自己的账单，然后拿着这份账单准备去接区块，但是在接区块的时候要做一份数学题，这个题目要求参与者首先准备一个字符串，这个字符串包含很多信息，其中主要包括下面这些：

- 前面区块的头部信息；
- 自己的账本信息；
- 时间戳；
- 其他信息；
- 随机数。

准备好字符串，对其做两次 SHA256 运算，也就是说先对字符串计算一次，得到 256 位二进制数，然后对这个结果在做一次 SHA256 运算。

最终我们得到一个 256 位的二进制数字，比特币要求结果符合前 n 位为 0 的条件才能获得打包的资格，而如果结果不满足条件，我们只能通过修改随机数再次进行 SHA256 运算并且比对结果，直到自己解答出答案，或者有其他人解答出答案，再到新的区块后面站队计算。如果你计算的结果刚好满足条件，那么你计算的结果就将作为新的头部信息，和账本一起打包成一个新的区块接在上一个区块的后方，然后你就可以获得你想要的奖励了。

有时可能运气好，几次计算就得到了满足条件的结果，有时可能没那么好，算了很多遍也得不出满足条件的结果，这时参与打包比拼的就是计算力，你只有计算足够多次数才有更大的可能性获得打包的权利赢得奖励。这其实就是比拼 CPU，比拼硬件，而从由此们也可以知道矿机都是计算力很强的机器。

上面的要求中 n 其实是一个变量，是用来做难度设置的。前面我们说到白皮书设计每 10 分钟要出一个区块，那么如何保证每十分钟可以出一个区块呢？这就要靠这个 n 位来设定难度，比特币会根据当前的计算力自动调整 n 位的难度，保证平均来说每 10 分钟可以成功出一个区块。简单来说，SHA256 的结果是二进制数字，要求一位为 0 是 50%的概率，每多要求一位则概率乘以 50%，那么要求 n 位为 0，概率就是 2 的 n 次方。比特币根据当前全球矿机的计算力计算出每十分钟能计算多少次 SHA256 操作，然后在换算成是 2 的多少次方，最终决定 n 的位数，以此来保证每 10 分钟可以且仅可以出一个区块。

所以，如果你想要获得更多的比特币，你可以做的就是去购买更多的矿机，拼命的去挖矿，这样你才可能获得更多的比特币。这就是挖坑的原理。

## 如何保证交易真实？如何认证和防伪？

传统认证方式对于一个电子记账系统已经不适用，所以我们要如何保证每一笔交易都是由比特币持有者发出的？而不是他人伪造的？

要解决认证的问题，就要使用到电子签名。比特币账户在注册时会生成一个随机数，这个随机数用来产生一个私钥，私钥可以产生一个公钥，公钥最终产生一个地址。

私钥需要保持私有，它是账户持有者身份认证所需要的，遗失私钥就等于损失了账户上所有比特币，有些人为了保护私钥，会准备一台不联网的计算机，将其保存在上面，或者强行记在脑子里。

公钥和地址是公开的，如果别人要给你转账，只需要提供地址给对方就可以收到转账；如果你要给别人转账，你需要提供公钥和地址才行。

你的私钥可以生成公钥，但是别人通过公钥是无法还原你的私钥的。私钥的功能是对信息进行加密，而公钥则对加密的信息进行解密，这种不对称的加密方式被称作非对称加密。比特币也是使用非对称加密方式进行加密，只有持有私钥的你自己可以以你的身份加密信息，别人无法伪装成你，而所有人都可以通过公钥解密你的信息。

所以如果甲要想向乙支付 1 个比特币，那么甲要做的就是写一条交易记录，然后对这条记录进行 SHA256 运算得出一份数字摘要，使用自己的私钥对摘要进行加密，然后将交易记录、自己的公钥和加密后的密码广播出去。

别人收到甲的广播之后，首先对交易记录进行 SHA256 运算得到一份数字摘要，然后使用甲的公钥对加密后的密码进行解密也得到一份数字摘要，最后对两份摘要进行比对，如果一致则认可这个交易确实是 A 的广播。而如果两份摘要不一致，则表明交易记录是伪造的，所有用户都会拒绝这份交易记录，来保证交易记录的有效性。

到此为止解决了第一个问题，那就是证明甲的交易记录是甲自己发出来的而不是被伪造的。现在我们可以识别甲发出的广播确实是甲发出来的了，但是接下来我们还要确认甲广播的交易是否有效，比如甲交易给乙 10 个比特币，但是甲的余额只有 5 个，显然这样的交易是无效的，那么我们如何甄别呢？

比特币通过追溯账本来做余额检查。每个人在使用比特币时都会下载区块链上从创世区块到当前区块的所有信息，然后做账本追溯，计算到当前区块甲还有多少余额，是否能够支付广播的数额。如果甲的余额足够，那么这条交易有效，会被记入接受广播者的账本中。反之，接收广播的人就会拒绝这条交易记录，这条信息就不会被打包到区块链上。

## 如何防止双重支付？
